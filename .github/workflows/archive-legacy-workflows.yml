---
name: "ğŸ—„ï¸ Archive Legacy Workflows"

on:
  workflow_dispatch:
    inputs:
      confirm:
        description: "Type 'yes' to confirm archiving legacy workflows"
        required: true
        default: 'no'

permissions:
  contents: write

jobs:
  archive-workflows:
    name: "ğŸ—„ï¸ Archive Legacy Workflows"
    runs-on: ubuntu-latest
    if: ${{ github.event.inputs.confirm == 'yes' }}
    steps:
      - name: "ğŸ“¥ Checkout Repository"
        uses: actions/checkout@v4

      - name: "ğŸ—„ï¸ Create Archive Directory"
        run: |
          mkdir -p .github/archived_workflows
          echo "# Archived Workflows" > .github/archived_workflows/README.md
          echo "" >> .github/archived_workflows/README.md
          echo "These workflows have been consolidated into newer, more maintainable workflows." >> .github/archived_workflows/README.md
          echo "They are kept here for reference purposes only." >> .github/archived_workflows/README.md
          echo "" >> .github/archived_workflows/README.md
          echo "See the main [workflows README](./../workflows/README.md) for details on the current workflow structure." >> .github/archived_workflows/README.md

      - name: "ğŸ—„ï¸ Move Legacy Workflows to Archive"
        run: |
          # Define an array of legacy workflows
          LEGACY_WORKFLOWS=(
            "pester-windows.yml"
            "pester-linux.yml"
            "pester-macos.yml"
            "auto-test-generation.yml"
            "auto-test-generation-setup.yml"
            "auto-test-generation-execution.yml"
            "auto-test-generation-reporting.yml"
            "workflow-health-monitor.yml"
            "comprehensive-health-monitor.yml"
            "update-dashboard.yml"
            "update-path-index.yml"
            "update-pester-failures-doc.yml"
          )

          # Move each workflow to the archive directory
          for workflow in "${LEGACY_WORKFLOWS[@]}"; do
            if [ -f ".github/workflows/$workflow" ]; then
              echo "Archiving $workflow"
              git mv ".github/workflows/$workflow" ".github/archived_workflows/$workflow"
            else
              echo "Workflow $workflow not found"
            fi
          done

          # Update the README with a list of archived workflows
          echo "## Archived Workflows" >> .github/archived_workflows/README.md
          echo "" >> .github/archived_workflows/README.md
          echo "| Original Workflow | Consolidated Into |" >> .github/archived_workflows/README.md
          echo "|------------------|-------------------|" >> .github/archived_workflows/README.md
          echo "| pester-windows.yml | unified-testing.yml |" >> .github/archived_workflows/README.md
          echo "| pester-linux.yml | unified-testing.yml |" >> .github/archived_workflows/README.md
          echo "| pester-macos.yml | unified-testing.yml |" >> .github/archived_workflows/README.md
          echo "| auto-test-generation.yml | auto-test-generation-consolidated.yml |" >> .github/archived_workflows/README.md
          echo "| auto-test-generation-setup.yml | auto-test-generation-consolidated.yml |" >> .github/archived_workflows/README.md
          echo "| auto-test-generation-execution.yml | auto-test-generation-consolidated.yml |" >> .github/archived_workflows/README.md
          echo "| auto-test-generation-reporting.yml | auto-test-generation-consolidated.yml |" >> .github/archived_workflows/README.md
          echo "| workflow-health-monitor.yml | system-health-monitor.yml |" >> .github/archived_workflows/README.md
          echo "| comprehensive-health-monitor.yml | system-health-monitor.yml |" >> .github/archived_workflows/README.md
          echo "| update-dashboard.yml | unified-utilities.yml |" >> .github/archived_workflows/README.md
          echo "| update-path-index.yml | unified-utilities.yml |" >> .github/archived_workflows/README.md
          echo "| update-pester-failures-doc.yml | unified-utilities.yml |" >> .github/archived_workflows/README.md

      - name: "ğŸ“ Commit Changes"
        run: |
          git config user.name 'github-actions[bot]'
          git config user.email 'github-actions[bot]@users.noreply.github.com'
          git add .github/archived_workflows
          git commit -m "chore: archive legacy workflows [skip ci]"
          git push
